<mat-card appearance="outlined">
  <mat-card-header>
    <mat-card-title>{{ reportname }}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="trimlineService.frmGroup">
      <div class="row-space-between">
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>Server</mat-label>
            <mat-select #lineSelect class="" formControlName="serverIndex" (selectionChange)="trimlineService.onFrmGroupChange()">
              <mat-option [value]="-1">All</mat-option>
              @for(s of trimlineService.trimline.servers; track s.index; let idx = $index ){
              <mat-option [value]="s.index">{{ s.server }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        @if(trimlineService.showTimeFrame()) {
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>Timeframe</mat-label>
            <mat-select #dateTypeSelection class="" formControlName="timeframe" (selectionChange)="trimlineService.onFrmGroupChange()">
              <mat-option [value]="TimeFrameEnum.Live">{{ TimeFrameEnum.Live }}</mat-option>
              <mat-option [value]="TimeFrameEnum.DateShift">{{ TimeFrameEnum.DateShift }}</mat-option>
              <mat-option [value]="TimeFrameEnum.Custom">{{ TimeFrameEnum.Custom }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        }
      </div>

      @if(trimlineService.showTimeFrame() && (timeFrame ===TimeFrameEnum.Archive || timeFrame === TimeFrameEnum.DateShift)) {
      <div class="row-space-between">
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>Date</mat-label>
            <input
              #dateInput
              (click)="picker.open()"
              matInput
              [matDatepicker]="picker"
              formControlName="date"
              (dateChange)="trimlineService.dateChange($event.value)"
            />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>Shift</mat-label>
            <mat-select #shiftSelect id="shiftSelection" formControlName="shift">
              @for(shift of shifts; track shift.name;let idx = $index){
              <mat-option [value]="idx + 1">{{ shift.name }} {{ homeService.getShiftTime(dateInput.value, shift) }} </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      } @if(trimlineService.showTimeFrame() && timeFrame=== TimeFrameEnum.Custom ) {
      <div class="row-space-between">
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>Date</mat-label>
            <input
              (click)="picker.open()"
              matInput
              [matDatepicker]="picker"
              formControlName="date"
              (dateChange)="trimlineService.dateChange($event.value)"
            />
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>
        <!-- <div class="col">
            <mat-form-field appearance="outline">
              <mat-label>Enter a date range</mat-label>
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate placeholder="Start date" formControlName="date" />
                <input matEndDate placeholder="End date" formControlName="toDate" />
              </mat-date-range-input>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </div> -->
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>From time</mat-label>
            <input matInput formControlName="fromTime" />
            <mat-error> Invalid time</mat-error>
          </mat-form-field>
        </div>
        <div class="mat-col">
          <mat-form-field appearance="outline">
            <mat-label>To time</mat-label>
            <input matInput formControlName="toTime" />
            <mat-error> Invalid time</mat-error>
          </mat-form-field>
        </div>
      </div>
      }
    </form>

    <app-mat-progress-spinner [visible]="trimlineService.showSpinner()"></app-mat-progress-spinner>
    @if(homeService.serverMap.servermapLoaded()){
    <div class="table-container">
      <router-outlet></router-outlet>
    </div>
    }
  </mat-card-content>
  <mat-card-footer>
    <div class="footer-container">
      <div class="button-group">
        <!-- <button mat-raised-button (click)="onRefresh()">Refresh</button> -->
        @if(trimlineService.showExportButton()){
        <button mat-raised-button (click)="trimlineService.onExport()">Export</button>
        }
      </div>

      <div class="status-indicators-container">
        <div *ngFor="let server of trimlineService.trimline.servers" class="status-indicator">
          <div
            class="indicator-dot"
            [ngClass]="{
              'status-online': server.enabled && server.state === 'online',
              'status-offline': server.enabled && server.state === 'offline',
              'status-unknown': server.enabled && server.state === 'unknown',
              pulse: server.enabled && server.state === 'online',
              'status-disabled': !server.enabled
            }"
          ></div>
          <span class="status-name">{{ server.server }}</span>
        </div>
      </div>
    </div>
  </mat-card-footer>
</mat-card>
